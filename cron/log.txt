================================================================================
Constituant - Import System Test
================================================================================

[ 1 ] Testing database connection...
      ✗ Database connection failed

[ 2 ] Testing configuration...
      ✓ Configuration loaded
      ✓ Found 3 enabled sources
        - NosDéputés.fr (Priority: 1)
        - La Fabrique de la Loi (Priority: 2)
        - European Parliament - Legislative Observatory (Priority: 3)

[ 3 ] Testing file permissions...
      ✓ Logs directory is writable

[ 4 ] Testing API connectivity...
      Testing NosDéputés...
      ✓ NosDéputés API accessible (104650 bytes)
      Testing EU Parliament...
      ✗ EU Parliament API NOT accessible
        Error: HTTP error 406
      Testing La Fabrique...
      ✓ La Fabrique API accessible (622824 bytes)
        ⚠ JSON parse failed (might be OK if API format changed)

[ 5 ] Testing date parsing...
      ✓ '2024-12-15 14:00:00' → '2024-12-15 14:00:00'
      ✓ '2024-12-15T14:00:00Z' → '2024-12-15 14:00:00'
[2025-12-06 11:11:48] [WARNING] Failed to parse date '15/12/2024': Failed to parse time string (15/12/2024) at position 0 (1): Unexpected character
      ✗ Failed to parse: '15/12/2024'
      ✓ 'Mon, 15 Dec 2024 14:00:00 GMT' → '2024-12-16 14:00:00'

[ 6 ] Testing bill data processing...
      Creating test bill...
      ✗ Failed to save test bill
        Error: Unable to connect to database. Please try again later.

[ 7 ] Testing log writing...
[2025-12-06 11:11:48] [INFO] Test log entry from test-import.php
      ✓ Log message written
      ✓ Log file exists: /mnt/f/constituant/cron/../../logs/bill-imports.log
      Last log entries:
        [2025-12-06 11:11:36] [WARNING] Failed to parse date '15/12/2024': Failed to parse time string (15/12/2024) at position 0 (1): Unexpected character
        [2025-12-06 11:11:36] [INFO] Test log entry from test-import.php
        [2025-12-06 11:11:48] [WARNING] Failed to parse date '15/12/2024': Failed to parse time string (15/12/2024) at position 0 (1): Unexpected character
        [2025-12-06 11:11:48] [INFO] Test log entry from test-import.php

[ 8 ] Testing live data fetch (limited)...
      Fetching 5 bills from NosDéputés.fr...
      Note: Set max_bills_per_source to 5 in config for real test
      ✓ Fetched 0 dossiers from API

================================================================================
Test Summary
================================================================================
✗ Errors found (1):
  1. Database connection failed: Unable to connect to database. Please try again later.

⚠ Warnings (3):
  1. Cannot connect to EU Parliament: HTTP error 406
  2. La Fabrique returned invalid JSON
  3. Failed to save test bill: Unable to connect to database. Please try again later.

Please fix errors before running the import system.
